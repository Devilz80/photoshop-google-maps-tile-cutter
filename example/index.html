<!DOCTYPE html>
<html lang="en">
	<head>
		<title>PS_Bramus.GoogleMapsTileCutter &mdash; Photoshop Google Maps Tile Cutter Example</title>
		<meta charset="utf-8" />
		<style>
			html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
			#map {
				width:100%;
				height:100%;
				text-align: center;
				font: 300 italic 72px/400px "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", sans-serif;
				color: #CCC;
				background: #EFEFEF;
			}
			#about {
				margin: 0;
				padding: 0;
				position: absolute;
				left: 0;
				bottom: 0;
				right: 0;
				border-top: 1px solid #ccc;
				height: 30px;
				font: 300 13px/30px "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", sans-serif;
				color: #333;
				background: #FFF;
				text-align: center;
			}
			#about a {
				color: #0067E3;
			}
		</style>
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-107008-28']);
			_gaq.push(['_trackPageview']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
	</head>
	<body>
		<a href="https://github.com/bramus/photoshop-google-maps-tile-cutter"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
		<div id="map">loading tiles...</div>
		<p id="about">This is an example implementation of tiles generated by <a href="https://github.com/bramus/photoshop-google-maps-tile-cutter">PS_Bramus.GoogleMapsTileCutter</a>, using <a href="http://www.flickr.com/photos/bramus/2445149769/">this picture</a> as a source.</p>
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
		<script>

			/*
			 * = Config
			 * ----------------
			 */

				var repeatOnXAxis = false; // Do we need to repeat the image on the X-axis? Most likely you'll want to set this to false
				var blankTilePath = 'tiles/_empty.jpg'; // Path to a blank tile when repeat is set to false
				var maxZoom = 4; // Maximum zoom level. Set this to the first number of the last tile generated (eg. 5_31_31 -> 5)


			/*
			 * Helper function which normalizes the coords so that tiles can repeat across the X-axis (horizontally) like the standard Google map tiles.
			 * ----------------
			 */

				function getNormalizedCoord(coord, zoom) {

					if (!repeatOnXAxis) return coord;

					var y = coord.y;
					var x = coord.x;

					// tile range in one direction range is dependent on zoom level
					// 0 = 1 tile, 1 = 2 tiles, 2 = 4 tiles, 3 = 8 tiles, etc
					var tileRange = 1 << zoom;

					// don't repeat across Y-axis (vertically)
					if (y < 0 || y >= tileRange) {
						return null;
					}

					// repeat across X-axis
					if (x < 0 || x >= tileRange) {
						x = (x % tileRange + tileRange) % tileRange;
					}

					return {
						x: x,
						y: y
					};

				}


			/*
			 * Main Core
			 * ----------------
			 */

				window.onload = function() {

					// Define our custom map type
					var customMapType = new google.maps.ImageMapType({
						getTileUrl: function(coord, zoom) {
							var normalizedCoord = getNormalizedCoord(coord, zoom);
							if(normalizedCoord && (normalizedCoord.x < Math.pow(2, zoom)) && (normalizedCoord.x > -1) && (normalizedCoord.y < Math.pow(2, zoom)) && (normalizedCoord.y > -1)) {
								return 'tiles/' + zoom + '_' + normalizedCoord.x + '_' + normalizedCoord.y + '.jpg';
							} else {
								return blankTilePath;
							}
						},
						tileSize: new google.maps.Size(256, 256),
						maxZoom: maxZoom,
						name: 'Champagne in the park'
					});

					// Basic options for our map
					var myOptions = {
						center: new google.maps.LatLng(0, 0),
						zoom: 2,
						minZoom: 0,
						streetViewControl: false,
						mapTypeControl: false,
						mapTypeControlOptions: {
							mapTypeIds: ["custom"]
						}
					};

					// Init the map
					var map = new google.maps.Map(document.getElementById('map'), myOptions);

					// Hook the our custom map type to the map and activate it
					map.mapTypes.set('custom', customMapType);
					map.setMapTypeId('custom');

				}
		</script>

	</body>
</html>